- [4.1 随机变量函数的概率密度函数](#41-随机变量函数的概率密度函数)
  - [4.1.1 线性函数](#411-线性函数)
  - [4.1.2 单调函数](#412-单调函数)
  - [4.1.3 两个随机变量的函数](#413-两个随机变量的函数)
  - [4.1.4 独立随机变量和——卷积](#414-独立随机变量和卷积)
- [4.2 协方差和相关](#42-协方差和相关)
  - [4.2.1 协方差的性质](#421-协方差的性质)
  - [4.2.2 随机变量的和的方差](#422-随机变量的和的方差)
  - [4.2.3 协方差的相关系数（the correlation coefficient）](#423-协方差的相关系数the-correlation-coefficient)
- [4.3 再论条件期望和条件方差](#43-再论条件期望和条件方差)
  - [4.3.1 重期望定理](#431-重期望定理)
  - [4.3.2 条件方差和全方差公式](#432-条件方差和全方差公式)
- [4.4 矩母函数](#44-矩母函数)
- [4.5 随机数个相互独立的随机变量之和](#45-随机数个相互独立的随机变量之和)

### 4.1 随机变量函数的概率密度函数

$d.r.v.$ 中求 $Y=g(X)$ 的分布列 $(PMF)$ 的方法：

<img src='./img/图4-1 离散随机变量中的导出PMF.png'>

<img src='./img/图4-2 d.r.v的导出PMF的线性性质.png'>

>若令 $Y=aX+b$，则 $a$ 因子相当于把 $p_X$ 拉伸了 $a$ 倍，$b$ 因子相当于将 $p_X$ 平移 $b$ 个单位，正右负左

上述 $PMF$ 的公式是用单点的概率进行推导的，而 $c.r.v$ 中单点概率为 $0$，所以 $c.r.v.$ 无法用类似的方法推导出 $PDF$。计算 $c.r.v.X$ 的函数 $Y=g(X)$ 的概率密度函数 $(PDF)$ 一般用 $CDF$ 进行求解：
- 首先计算 $F_Y$，
  $$
  F_Y(y)=P(g(X)\leqslant y)=\int_{\{x|g(x)\leqslant y\}}f_X(x)dx
  $$
- 对 $F_Y$ 求导，得到 $Y$ 的 PDF，
  $$
  f_Y(y)=\frac{dF_Y}{dy}(y)
  $$

下图是用上述步骤解出 $PDF$ 的几个例子，

<img src='./img/图4-1-1 Y=g(X)的PDF求法的例子.png' />

<img src='./img/图4-1-2 c.r.v的非单调函数的PDF的求解例子.png'/>

#### 4.1.1 线性函数
下图是 $c.r.v.X$ 转换为 $c.r.v.Y$ 的过程，其中 $Y=2X+3$，

<img src='./img/图4-3 c.r.v.的线性函数的PDF.png'>

与离散的情况类似，$Z=2X$ 将 $f_X$ 水平拉伸两倍，不同的是，在连续情况下，为了使 $f_Z$ 之下围成的面积为 $1$，需要将 $f_X$ 的纵轴下拉到原来的 $\frac12$；$Y=Z+3$ 将 $f_Z$ 水平右移 $3$ 个单位；

下面推导连续情况下线性函数的 $PDF$ 的公式，设 $Y=aX+b$，$a=0$ 时，$Y$ 为常数，此时 $Y$ 是一个离散的 $r.v.$ 没有 $PDF$，接下来讨论 $a>0$ 和 $a<0$ 的情况，

联想离散情况下线性函数的 $PMF$ 的推导过程（下图的绿色部分）发现导出的 PMF 是用单点的概率进行求解的，而在连续情况下单点的概率为零，用上述方法求解只能得到 $0=0$ 的结果，不能给我们提供任何信息；

对于连续情况下线性函数的 $PDF$ 的推导，一般使用 $CDF$ 进行求解，求出 $F_Y$，然后求导，即可得到 $f_Y$，

<img src='./img/图4-4 c.r.v的线性函数的PDF公式的证明.png'>

>上述两种情况，可以总结为一个公式

通过比较离散和连续情况下，线性函数的 $PMF$ 和 $PDF$ 公式可以发现，除了 $PDF$ 中的比例因子外，两者具有相同的形状，因此，在连续情况下，我们需要垂直放缩 $PDF$，而离散情况下不需要；

**线性变换之下随机变量的正态性保持不变**的证明：

<img src='./img/图4-5 正态随机变量的线性变换仍是正态.png'>

>直接用期望和方差的线性规则不就能推导了吗？用期望和方差的线性规则只能推导出变换后的期望和方差，并不能说明经过线性变换后的随机变量仍有正态随机变量的形式

#### 4.1.2 单调函数
连续随机变量 $X$ 的严格单调函数 $Y=g(X)$ 的概率密度函数计算公式：

假设 $g$ 是严格单调函数，其反函数为 $h$ 且 $h$ 是可微的，则 $Y$ 的概率密度函数为
$$
f_Y(y)=f_X(h(y))\left |\frac{dh}{dy}(y)\right|.
$$

下面是证明过程，

<img src='./img/图4-6 连续随机变量的单调函数的PDF公式的证明.png'/>

>当 $g$ 是严格递增时，事件 $\{g(X)\leqslant y\}$ 与事件 $\{X\leqslant h(y)\}$ 相同；当 $g$ 是严格递减时，事件 $\{g(X)\leqslant y\}$ 与事件 $\{X\geqslant h(y)\}$ 相同；详见书 $P_{182}$

下图是一种更为直观的证明方式：

<img src='./img/图4-7 证明c.r.v的单调函数的PDF公式的一种更直观的方式.png' />

>当 $x$ 移动 $\delta_1$ 个单位时，$y$ 对应移动 $\delta_1·\frac{dg}{dx}(x)$ 个单位即 $\delta_2$

#### 4.1.3 两个随机变量的函数

<img src='./img/图4-8 两个随机变量的函数的PDF求法.png' />

$F_Z(z)=P(Z\leqslant z)=P\left(\frac{Y}{X} \leqslant z\right )$

$X$ 和 $Y$ 是非负数，所以 $Z$ 不可能小于 $0$，所以 $z<0,\,\,F_Z(z)=0$；

$P\left(\frac{Y}{X} \leqslant z\right ) = P(Y\leqslant zX)$，在图中画一条斜率为 $z$ 直线，在该直线的下方满足 $Y\leqslant zX$，所以该事件的概率就是该直线下方的阴影部分，由图可得，随着斜率的变化，阴影部分的面积也会变化，但可总结为两种图形的面积——三角形和梯形，

当 $0\leqslant z\leqslant 1$ 时，直线下方的阴影部分为三角形，此时的面积为 $\frac12z$；

当 $z>1$ 时，直线下方的阴影部分为梯形，可用正方形的面积减三角形的面积求解，此时面积为 $1-\frac{1}{2z}$；

这样就求得了 $CDF$，然后对 $CDF$ 求导即可得到相应的 $PDF$；

#### 4.1.4 独立随机变量和——卷积

计算离散情况下独立随机变量 $X$ 和 $Y$ 的和，$Z=X+Y$，假设我们要计算 $P_Z(3)$ 即 $X+Y=3$ 的概率，根据离散情况下，随机变量的函数的 PMF 求法，只需要将所有满足 $X+Y=3$ 的点的概率相加即可，因为 $X$ 和 $Y$ 是独立的，所以有下述推导过程，进而可以推导出一般情况下的公式，即离散情况下的卷积公式（convolution of two PMFs）；

<img src='./img/图4-9 the-distribution-of-X+Y-the-discrete-case.png' />

如何用卷积公式计算 $PMF$ ?

<img src='./img/图4-10 discrete-convolution-mechanics.png' />

- 一般方法：找出 $X,\,\,Y$ 中满足 $X+Y=Z$ 的点，计算单点的概率，然后相加；
- 图像法：以纵轴为对称轴，翻转 $p_Y$，在 $p_X$ 的图像下画出翻转后并平移了 $z$ 个单位 $p_Y$，将两个 $PMF$ 中取相同值的点的概率相乘，然后将各个相同值相乘的结果相加，即可得到 $p_Z(z)$；

计算连续情况下的 $Z=X+Y$，假设我们依旧是计算 $X+Y=3$ 的概率，即 $f_Z(3)$，离散情况下的 $p_Z(3)$ 等于所有满足 $X+Y=3$ 的点的概率的和，即 $\sum_xp_X(x)p_Y(3-x)$；对于 $f_Z(3)$ 所有满足 $X+Y=3$ 的点构成了一条直线，需要用积分来求概率和，即 $\int_{-\infin}^\infin f_X(x)f_Y(3-x)dx$。类似地，可推导出连续情况下的卷积公式 $f_Z(z)=\int_{-\infin}^\infin f_X(x)f_Y(z-x)dx$，下面是严格的证明；

<img src='./img/图4-11 continuous-convolution-formal.png' />

$f_{X+b}(x) = f_X(x-b)$ 的推导：
$$
\begin{align}
&f_{X+b}(x)·\delta\approx P(x\leqslant X+b\leqslant x+\delta) \nonumber\\[1.5ex]
&= P(x-b\leqslant X\leqslant x-b+\delta)\approx f_X(x-b)·\delta\nonumber
\end{align}
$$

连续情况下的卷积也可以用图像法进行求解，翻转，平移，然后对相同的部分进行积分；

两个独立的正态随机变量的和及其结论，

<img src='./img/图4-12 the-sum-of-independent-normal-rvs.png' />

两个独立正态随机变量之和仍是正态的；正态随机变量的线性函数仍是正态的；对于任何非零常数 $a,\,\,b$，$aX+bY$ 也是正态的；（未证）

### 4.2 协方差和相关

<img src='./img/图4-13 covariance-def.png' />

在离散情况下，如果 $X$ 和 $Y$$ 是独立的并且期望为 0，则 $E[XY]=E[X]E[Y]=0$；上图左边的 $c.r.v.$ 中，大多数点都集中在 $XY>0$ 的区间，则有 $E[XY]>0$，右图中，大多数点都集中在 $XY<0$ 的区间，则有 $E[XY]<0$；$E[XY]$ 的值告诉我们 $X$ 和 $Y$ 是倾向于相同的方向还是相反的方向移动。这就是 $0$ 期望下协方差的例子；

协方差对于任两个随机变量都有定义，当期望非零时，有，
$$
cov(X,Y)=E\left[(x-E[X])·(Y-E[Y])\right]
$$
协方差是 $X$ 相对于它的期望的偏差和 $Y$ 相对于它的期望的偏差的均值，从中我们可以得到这两个偏差是否有相同的符号，这两个偏差是否向相同的方向移动。

从上面的公式可以推导出，当 $X$ 和 $Y$ 独立时，$cov(X,Y)=0$；但是 $cov(X,Y)=0$ 并不能推出独立，例如上面的例子中，协方差为 $0$，但是当 $X=1$ 时，可以推出 $Y=0$，$X$ 的取值为 $Y$ 的取值提供了信息，所以 $X$ 和 $Y$ 不独立；

#### 4.2.1 协方差的性质

<img src='./img/图4-14 covariance-properties.png' />

>后两个公式的证明都是建立在期望为 0 的基础上，也可以不对期望进行假设，只是假设为 0 后容易证一点；

协方差的线性性质中 $b$ 没有影响的原因，如果我们给一个随机变量加上一个常数，那么它的期望也会加上这个常数，而协方差中是随机变量和期望的差值，所以添加常数没有影响；

#### 4.2.2 随机变量的和的方差

<img src='./img/图4-15 两个随机变量的和的方差公式.png' />

当这两个随机变量独立时，和的方差就等于方差的和；

<img src='./img/图4-16 n个随机变量的和的方差公式.png' />

当这 $n$ 个随机变量独立时，和的方差等于方差的和；当它们不独立时，它们的和等于方差的和加上这 $n$ 个随机变量的协方差的组合再乘 $2$；

虽然上面的推导过程是在假设期望为零的前提下进行的，但是在期望非零的情况下也成立，书上有期望为任意值的证明 $P_{192}$

#### 4.2.3 协方差的相关系数（the correlation coefficient）

协方差可以告诉我们随机变量之间的依赖性强度，但是无法直接通过协方差直接的定性描述。例如，我们知道 $cov(X,Y)=5$，但这并不能给我们提供这两个变量之间的依赖性关系；另一个问题是，如果 $X$ 和 $Y$ 的单位为米，那么协方差的单位就是平方米，这就更难解释协方差的含义了；为此，引入了相关系数；

<img src='./img/图4-17 corelation-coefficient.png' />

相关系数是无量纲的，它定义为协方差除以标准差的乘积，公式如下，

$$
\rho(X,Y)=E\left(\frac{(X-E[X])}{\sigma_X}·\frac{(Y-E[Y])}{\sigma_Y} \right)=\frac{cov(X,Y)}{\sigma_X\sigma_Y}
$$

相关系数的值在 $[-1,1]$ 之间，它可以表示两个随机变量之间的相关程度。

相关系数的一些性质：
- $|\rho|\leqslant 1$；
- 当两个随机变量独立时，$\rho=0$ 说明这两个随机变量是不相关的；
- $\rho(X,X)=1,\,\,\rho(X,-X)=-1$；
- 当 $X$ 和 $Y$ 具有线性关系时，$|\rho|=1$；
- $cov(aX+b,Y)=a·cov(X,Y)\rArr\rho(aX+b,Y)=sign(a)·\rho(X,Y)$

  这意味着当我们改变随机变量的单位时，随机变量的相关程度并不会改变。例如，假设 $X$ 是摄氏度，$aX+b$ 是华氏度，当摄氏度转变为华氏度时并没有改变温度与其它随机变量的相关程度；

**$|\rho|\leqslant 1$ 的证明：**
<img src='./img/图4-18 corelation-coefficient-the-key-property-proof.png'/>

>上图虽然是在期望为零，方差为一的情况下证明的 $|\rho|\leqslant 1$，但是，对于一般情况，证明思想类似，只是步骤多了点，完整的证明过程见 $P_{218}$

**对相关系数的进一步理解：**

<img src='./img/图4-19 对相关系数的进一步理解.png' />

- 相关系数很大并不表明它们之间存在因果关系，但可以反映它们之间存在一个相同的隐藏的共同因子。比如上图中的 $X$ 和 $Y$；

- 在上图中，在假设 $Z,\,\,V,\,\,W$ 相互独立并且期望为零，均值为一的情况下，可以推出 $\rho(X,Y)=\frac{1}{2}$。

- 当 $\rho(X,Y)=\frac12$ 时，它意味着 $X$ 和 $Y$ 之间有一些共同元素，也有一些特殊元素，并且这两种元素的所占的比重大致相等；如果特殊元素完全不存在，即图中的 $V$ 和 $W$ 不存在，那么 $\rho(X,Y)=1$；如果特殊元素的方差很大，完全屏蔽了共同元素的影响，则 $\rho(X,Y)=0$；

<img src='./img/图4-20 一个和相关系数有关的投资问题.png' />

房地产投资，假设你有 $100M$，向十个州分别投资 $10M$，用随机变量 $X_i$ 表示从第 $i$ 个州得到的利润，期望为 $1$，标准差为 $1.3$，单位 $M$；

$\rho(X_i,X_j)$ 表示州与州之间市场的相关程度，从上图的推导可以得到，当相关系数为零时，分开投资的风险很低，当相关系数很大时，分开投资的风险也很高；

### 4.3 再论条件期望和条件方差
<img src='./img/图4-21 抽象的条件期望是一个随机变量.png' />

首先给了一个随机变量的函数的例子，$h(X)=X^2$，是随机变量 $X$ 的函数，它也是一个随机变量；

对于条件期望 $E[X|Y=y]$，每一个 $y$ 都对应一个实数值，所以 $E[X|Y=y]$ 也能看作为一个函数，它是随机变量 $Y$ 的函数，所以抽象的条件期望也是一个随机变量。它具有随机变量的所有性质，接下来就是对这些性质进行探讨；

#### 4.3.1 重期望定理

<img src='./img/图4-22 重期望法则的证明.png'>

>图中是离散情况下的证明，连续的也类似

**折棍问题（Stick-breaking example）**

有一个长度为 $l$ 的木棍，第一次从 $X$ 处折断，$X$ 是 $[0,l]$ 上的均匀分布，第二次从剩余部分的 $Y$ 处扯断，$Y$ 是 $[0,X]$ 上的均匀分布，求 $Y$ 的期望；

<img src='./img/图4-23 stick-breaking-example.png' />

<img src='./img/图4-23 stick-breaking-example2.png' />

>$E[X]=\frac l2$；$E[Y]$ 可用期望公式直接求得，也可用全期望公式，还可使用重期望定理

<img src='./img/图4-25 使用重期望定理解决折棍问题.png' />

<img src='./img/图4-26 重期望定理解释.png' />

假设你通过计算所给信息的期望值来对二月的销售额进行预测，在年初时，你的预测值为 $E[X]$，到了一月底，在已知一月的销售额的情况下对原有的预测值进行修改，修改后值为 $E[X|Y=y]$，$Y$ 为一月的销售额。

由重期望定理可得 $E[E[X|Y]]=E[X]$，即修改后的预测值的预测值（平均）为最初的预测，也就是说，就平均而言预测值并不会根据新增条件而发生变化；不符合现实生活，视频的解释是原有的预测有误差；

#### 4.3.2 条件方差和全方差公式

<img src='./img/图4-27 条件方差.png' />

<img src='./img/图4-28 全方差公式的证明.png' />

<img src='./img/图4-29 全方差公式例子.png' />

<img src='./img/图4-30 重期望和全方差公式例子.png' />

<img src='./img/图4-30 重期望和全方差公式例子续.png' />

全班学生成绩的方差由两部分组成，第一部分看每组内的方差，取各组方差的平均值，然后再取所有组的方差的平均值；第二部分看不同组之间的均值，看它们与全班平均水平差多少，即对它们求方差；

测试整体分数的随机性，可以分为两个随机性，一个随机性是不同部分有不同的平均分数，另一个是学生的分数与它们所在组的平均分数不同；

### 4.4 矩母函数

### 4.5 随机数个相互独立的随机变量之和