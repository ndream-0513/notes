## 2.1 应用层协议原理

### 2.1.1 网络应用程序体系结构

网络的体系结构为五层英特网体系结构，分为应用层、传输层、网络层、数据链路层和物理层，网络应用程序体系结构不同于网络的体系结构，主要有**客户-服务器(C/S)体系结构**和**对等(P2P)体系结构**两种，

- C/S体系结构：C/S体系结构中，有一个总是打开的主机称为**服务器**，它服务于来自许多其他称为**客户**的主机的请求
  - C/S体系结构中，客户之间相**互不通信**
  - 服务器具有**固定、周知的地址**，用户客户联系服务器(向服务器发送分组)
  - 在C/S应用中，常常会出现一台单独的服务器主机跟不上它所有客户请求的情况，为此，配备大量主机的数据中心常被用于创建强大的**虚拟服务器**
- P2P体系机构：对位于数据中心的专用服务器有最小的依赖(或者没有)，应用程序在间断连接的主机对之间使用直接通信，这些主机对被称为**对等方**。对等方不为ISP所有，一般为用户控制的主机所有
  - 具有**自扩展性**。例如在一个P2P文件共享系统中，尽管每个对等方都由于请求文件产生工作负载，但每个对等方通过向其他对等方分发文件也为系统增加了服务能力
  - 具有**成本效率**。不需要庞大的服务器基础设施和服务器带宽
  - P2P的安全性、性能和可靠性还有待商榷
- 某些应用具有**混合的体系结构**，它结合了C/S和P2P的元素。例如许多即时讯息应用，服务器被用于跟踪用户的IP地址，但用户到用户之间的报文在用户主机之间(无需通过中间服务器)直接发送

### 2.1.2 进程通信

主机之间的通信实际上是进程之间的通信，而不是程序。在同一主机上，进程之间的通信方式由操作系统决定；在两个不同主机之间的进程通信是通过跨越计算机网络交换报文(message)实现的，计算机网络主要对第二种进程通信的方式进行讨论

- **客户和服务器进程**：在一对进程之间的通信会话场景中，发起通信的进程被标识为客户，在会话开始时等待联系的进程是服务器。C/S体系体系结构中，客户和服务器的角色是固定的；P2P体系结构中，对等方之间既可以为客户也可以为服务器，但在某一时刻，客户和服务器是固定的
- **进程与计算机网络之间的接口**：进程通过一个称为**套接字**(socket)的软件接口向网络发送报文和从网络接收报文
  - 应用程序开发者可以控制套接字在应用层端的一切，但是对该套接字的运输层端几乎没有控制权
  - 应用程序开发者对于运输层的控制仅限于：选择运输协议；也许能够设定几个运输层参数，如最大缓存和最大报文段长度
- **进程寻址**：一台主机中的进程为了向另一台主机中的进程发送报文，需要直到接收进程的地址，为了标识接收进程的地址，需要定义两种信息：主机地址(**IP地址**)、在目的主机中指定接收进程的标识符(**端口**)
  - web服务器(http)端口号为80；邮件服务进程(SMTP)的端口号为25

### 2.1.3 可供应用程序使用的运输服务

应用程序为了实现各种各样的功能需要运输层提供什么服务？以及如何选择一个运输层的协议？

运输层协议能够为调用它的应用程序提供的服务大体可以分为四个方面：可靠数据传输、吞吐量、定时和安全性

- **可靠数据传输**：对于像电子邮件、文件传输、远程主机访问、Web文档传输以及金融应用之类的应用，数据丢失会造成很大的影响，所有要求传输层提供可靠的数据传输服务；对于一些多媒体应用，可以承受一定量的数据丢失的应用称为**容忍丢失的应用**，不要求应用层提供可靠的数据传输
- **吞吐量**：可用吞吐量是指发送进程能够向接收进程交付比特的速率，该吞吐量会随着时间波动(因为网络带宽是共享的，用的人多了就拥挤了)，这就导致了一种自然的服务，即**运输层协议能够以某种特定的速率提供确保的可靠吞吐量**。
  - 具有吞吐量要求的应用程序被称为**带宽敏感的应用**。比如多媒体应用
  - 可以根据当时可用的带宽或多或少地利用可供使用的吞吐量的程序称为**弹性应用**。比如电子邮件、文本传输以及Web传送等

- **定时**：报文是否能够定时到达。对于一些交互式游戏，为了保证数据的有效性对数据交付有严格的时间限制
- **安全性**：机密性(数据加密解密)、数据完整性、端点鉴别等

### 2.1.4 因特网提供的运输服务

- **TCP**：面向连接的服务、可靠的数据传输、拥塞控制机制

  - TCP和UDP都没有提供加密机制，为了保证数据的安全性，可通过SSL对TCP进行加强。

    > SSL不是与TCP和UDP在相同层次上的第三种英特网运输协议，而是一种对TCP的加强，这种强化是在应用层上实现的

- **UDP**：不提供不必要的服务、没有握手过程、不可靠数据传输、没有拥塞控制机制

- **因特网运输协议所不提供的服务**：今天的因特网通常能够为时间敏感应用提供满意的服务，但它不能提供任何定时或带宽的保证

### 2.1.5 应用层协议

通过将报文发送进套接字实现网络进程间的相互通信，但是如何构造报文、报文中个字段的含义、进程何时发送报文，这些都是应用层协议所定义的。**应用层协议**一般定义了以下**内容**：

- 交换的报文类型。如请求报文和相应报文
- 各种报文类型的语法。如报文中有多少字段，如何对这些字段进行描述
- 字段的语义。即这些字段中的信息的含义
- 确定一个进程何时发送报文以及对报文进行响应的规则

**区分网络应用和应用层协议**：

- web应用 = HTML + Web浏览器 + Web服务器 + 应用层协议(http，重要部分)
- 电子邮件应用 = 邮件服务器 + 邮件客户程序 + 定义电子邮件报文结构的标准 + 定义报文如何在服务器之间以及如何在服务器和邮件客户程序之间传送的应用层协议 + 定义如何对报文首部的内容进行解释的应用层协议