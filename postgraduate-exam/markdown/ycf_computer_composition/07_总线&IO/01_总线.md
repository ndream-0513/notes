##  1.1 总线

随着计算机的发展和应用领域的不断扩大，IO设备的种类和数量也越来越多。为了更好地解决IO设备和主机之间连接的灵活性问题，计算机的结构从分散连接发展为总线连接。为了进一步简化设计，又提出了各类总线标准。

### 1.1.1 总线概述

- **总线的定义**：总线是一组能为多个部件分时共享的公共信息传送线路。分时和共享是总线的两个特点。分时是指同一时刻只允许有一个部件向总线发送信息，若系统中有多个部件，则它们只能分时地向总线发送信息。共享是指总线上可以挂接多个部件，多个部件可同时从总线上接收相同的信息。

- **总线的分类**：计算机系统中的总线，按功能划分为以下3类。

  - 片内总线(内部总线)：片内总线是芯片内部的总线，它是CPU 芯片内部寄存器与寄存器之间、寄存器与ALU 之间的公共连接线。

  - 系统总线：系统总线是计算机系统内各功能部件(CPU、主存、I/O接口)之间相互连接的总线。按系统总线传输信息内容的不同，又可分为3类：数据总线、地址总线和控制总线。

    - 数据总线：用来传输各功能部件之间的数据信息，它是双向传输总线，其位数与**机器字长、存储字长**有关。

    - 地址总线: 用来指出数据总线上的源数据或目的数据所在的**主存单元**或**I/O端口的地址**，它是单向传输总线，地址总线的位数与主存地址空间的大小有关。

    - 控制总线：传输的是控制信息，包括CPU送出的控制命令和主存（或外设）返回CPU的反馈信号。

      >注意区分数据通路和数据总线:各个功能部件通过数据总线连接形成的数据传输路径称为数据通路。数据通路表示的是数据流经的路径，而数据总线是承载数据的媒介。

  - I/O总线：主要用于连接中低速的I/O设备，通过I/O接口与系统总线连接，目的是将低速设备与高速总线相分离，以提升系统总线的性能，常见的有USB总线、PCI总线

  按时序控制方式可将总线划分为**同步总线**和**异步总线**，还可按数据传输格式将总线划分为**并行总线**和**串行总线** 。

  >注意：并行总线传输通常比串行总线传输快，但这不是绝对的。并行总线由于是多个数据位同时传输，需要考虑数据的协同性，以及线路之间的相互干扰，这导致工作频率无法持续提高。而串行总线可通过不断提高工作频率来提高传输速度，使其速度最终超越并行总线

- **系统总线的结构**（总线结构通常分为单总线结构、双总线结构和三总线结构等）

  - **单总线结构**：单总线结构将CPU、主存、IO设备（通过IO接口）都挂在一组总线上，允许IO设备之间、IO设备与主存之间直接交换信息。CPU与主存、CPU与外设之间可直接进行信息交换，而无须经过中间设备的干预。

    > 注意：单总线并不是指只有一根信号线，系统总线按传送信息的不同可细分为地址总线、数据总线和控制总线。

    - 优点：结构简单，成本低，易于接入新的设备；
    - 缺点：带宽低、负载重，多个部件只能争用唯一的总线，且不支持并发传送操作；

  - **双总线结构**：双总线结构有两条总线，一条是**主存总线**，用于在CPU、主存和通道之间传送数据；另一条是**IO总线**，用于在多个外部设备与通道之间传送数据
    - 优点：将低速IO设备从单总线上分离出来，实现了存储器总线和IO总线分离；
    - 缺点：需要增加通道等硬件设备；

  - **三总线结构**：三总线结构是在计算机系统各部件之间采用3条各自独立的总线来构成信息通路，这3条总线分别为**主存总线**、**IO总线**和**直接内存访问(DMA)总线**。主存总线用于在CPU和内存之间传送地址、数据和控制信息；IO总线用于在CPU和各类外设之间通信；DMA总线用于在内存和高速外设之间直接传送数据。
    - 优点：提高了IO设备的性能，使其更快地响应命令，提高系统吞吐量。
    - 缺点：系统工作效率较低。

- **总线的性能指标**

  - 总线的传输周期：指一次总线操作所需的时间（包括申请阶段、寻址阶段、传输阶段和结束阶段)，简称总线周期。总线传输周期通常由若干总线时钟周期构成。

  - 总线时钟周期：即机器的时钟周期。计算机有一个统一的时钟，以控制整个计算机的各个部件，总线也要受此时钟的控制。

  - 总线的工作频率：总线上各种操作的频率，为总线周期的倒数。实际上指1秒内传送几次数据。若总线周期=N个时钟周期，则总线的工作频率=时钟频率/N。

  - 总线的时钟频率：即机器的时钟频率，它为时钟周期的倒数。

  - 总线宽度：又称总线位宽，它是总线上同时能够传输的数据位数，通常指数据总线的根数，如32根称为32位总线。

  - 总线带宽：可理解为总线的数据传输率，即单位时间内总线上可传输数据的位数，通常用每秒传送信息的字节数来衡量，单位可用字节/秒（B/s）表示。总线带宽=总线工作频率×(总线宽度/8)。

    > 注意:总线带宽和总线宽度应加以区别。

  - 总线复用：总线复用是指一种信号线在不同的时间传输不同的信息，因此可以使用较少的线传输更多的信息，从而节省空间和成本。
  - 信号线数：地址总线、数据总线和控制总线，3种总线数的总和称为信号线数。其中，总线的最主要性能指标为总线宽度、总线（工作）频率、总线带宽，总线带宽是指总线本身所能达到的最高传输速率，它是衡量总线性能的重要指标。

### 1.1.2 总线事务和定时

- **总线事务**：从请求总线到完成总线所使用的操作序列称为总线事务，它是在一个总线周期中发生的一系列活动。典型的总线事务包括请求操作、仲裁操作、地址传输、数据传输和总线释放五个阶段
  - 请求操作：主设备（CPU或DMA）发出总线传输请求，并获得总线控制权
  - 仲裁操作：总线仲裁机构决定将下一个传输周期的总线使用权授予某一个使用者
  - 地址传输：主设备通过总线给出要访问的从设备地址及有关命令，启动从模块
  - 数据传输：主模块和从模块进行数据交换，可进行单向或双向数据传送
  - 总线释放：主模块的有关信息均从系统总线上撤除，让出总线使用权

- **总线定时**：是指总线在双方交换数据的过程中需要时间上配合关系的控制，这种控制称为总线定时，其实质是一种协议或规则，主要有同步、异步、半同步和分离式4种定时方式。

  - 同步定时方式：指系统采用一个统一的时钟信号来协调发送和接收双方的传送定时关系。时钟产生相等的时间间隔，每个间隔构成一个总线周期。在一个总线周期中，发送方和接收方可以进行一次数据传送。因为采用统一的时钟，每个部件或设备发送或接收信息都在固定的总线传送周期中，一个总线的传送周期结束，下一个总线的传送周期开始。

    - 优点：传送速度快，具有较高的传输速率；总线控制逻辑简单。

    - 缺点：主从设备属于强制性同步;不能及时进行数据通信的有效性检验，可靠性较差。

      > 同步通信适用于总线长度较短及总线所接部件的存取时间比较接近的系统。

  - 异步定时方式：异步定时方式中，没有统一的时钟，也没有固定的时间间隔，完全依靠传送双方相互制约的“握手”信号来实现定时控制。通常，把交换信息的两个部件或设备分为主设备和从设备，主设备提出交换信息的“请求”信号，经接口传送到从设备；从设备接到主设备的请求后，通过接口向主设备发出“回答”信号。

    - 优点：总线周期长度可变，能保证两个工作速度相差很大的部件或设备之间可靠地进行信息交换，自动适应时间的配合。
    - 缺点：比同步控制方式稍复杂一些，速度比同步定时方式慢。

  - 根据“请求”和“回答”信号的撤销是否互锁，异步定时方式又分为以下3种类型：

    - 不互锁方式：主设备发出“请求”信号后，不必等到接到从设备的“回答”信号，而是经过一段时间便撤销“请求”信号。而从设备在接到“请求”信号后，发出“回答”信号，并经过一段时间后自动撤销“回答”信号。双方不存在互锁关系。

    - 半互锁方式：主设备发出“请求”信号后，必须在接到从设备的“回答”信号后，才撤销“请求”信号，有互锁的关系。而从设备在接到“请求”信号后，发出“回答”信号，但不必等待获知主设备的“请求”信号已经撤销，而是隔一段时间后自动撤销“回答”信号，不存在互锁关系。

    - 全互锁方式：主设备发出“请求”信号后，必须在从设备“回答”后才撤销“请求”信号；从设备发出“回答”信号后，必须在获知主设备“请求”信号已撤销后，再撤销其“回答”信号。双方存在互锁关系。

  - 半同步定时方式

  - 分离式定时方式

### 1.1.3 总线标准

总线标准是国际上公布或推荐的互连各个模块的标准，是把各种不同的模块组成计算机系统时必须遵守的规范。按总线标准设计的接口可视为通用接口，在接口的两端，任何一方只需根据总线标准的要求完成自身方面的功能要求，而无须了解对方接口的要求。

目前，典型的总线标准有ISA、EISA、VESA、PCI、PCI-Express、AGP、RS-232C、USB等。它们的主要区别是总线宽度、带宽、时钟频率、寻址能力、是否支持突发传送等。

- ISA(Industry Standard Architecture，工业标准体系结构)：最早出现在微型计算机上的系统总线，应用在IBM的AT机上。
- EISA(Extended Industry Standard Architecture，扩展的ISA)总线：为配合32位CPU而设计的扩展总线，EISA对ISA完全兼容。

- VESA(Video Electronics Standards Association，视频电子标准协会)总线：是一个32位标准的计算机局部总线，是针对多媒体PC要求高速传送活动图像的大量数据应运而生的。
- PCI(Peripheral Component Interconnect，外部设备互连)总线：是高性能的32位或64 位总线，是专为高度集成的外围部件、扩充插板和处理器/存储器系统设计的互连机制。目前常用的PCI适配器有显卡、声卡、网卡等。PCI总线支持即插即用。PCI总线是一个与处理器时钟频率无关的高速外围总线，属于局部总线。PCI总线可通过桥连接实现多层PCI总线。
- PCI-Express(PCI-E)：PCI-Express是最新的总线和接口标准，它将全面取代现行的PCI和AGP，最终统一总线标准。
- AGP(Accelerated Graphics Port，加速图形接口)：是一种视频接口标准，专用于连接主存和图形存储器，属于局部总线。AGP技术为传输视频和三维图形数据提供了切实可行的解决方案。
- RS-232C(Recommended Standard，RS)：是由美国电子工业协会（EIA）推荐的一种串行通信总线，是应用于串行二进制交换的数据终端设备(DTE)和数据通信设备(DCE)之间的标准接口。
- USB(Universal Serial Bus，通用串行总线)：是一种连接外部设备的IO总线，属于设备总线。具有即插即用、热插拔等优点，有很强的连接能力。
- PCMCIA(Personal Computer Memory Card International Association：是广泛应用于笔记本电脑的一种接口标准，是一个用于扩展功能的小型插槽。PCMCIA具有即插即用功能。
- IDE(Integrated Drive Electronics，集成设备电路)：更准确地称为ATA，是一种IDE接口磁盘驱动器接口类型，硬盘和光驱通过IDE接口与主板连接。
- SCSI(Small Computer System Interface，小型计算机系统接口)：是一种用于计算机和智能设备之间（硬盘、软驱、光驱、打印机等）系统级接口的独立处理器标准。SCSI是一种智能的通用接口标准。
- SATA(Serial Advanced Technology Attachment，串行高级技术附件)：是一种基于行业标准的串行硬件驱动器接口，是由Intel、IBM、Dell、APT、Maxtor和 Seagate公司共同提出的硬盘接口规范。